version: '3'
services:
  spire-server:
    image: spire-server:latest-local
    hostname: spire-server
    volumes:
      - ./conf/server:/opt/spire/conf/server
    command: [ "-config", "/opt/spire/conf/server/server.conf" ]
  oidc-discovery-provider-server:
    image: oidc-discovery-provider:latest-local
    hostname: oidc-discovery-provider-server
    depends_on: [ "spire-server" ]
    volumes:
      - ./conf/oidc-discovery-provider:/opt/spire/conf/oidc-discovery-provider
      - ./conf/agent:/opt/spire/conf/agent
      - ./conf/server:/opt/spire/conf/server
    command: [ "-config", "/opt/spire/conf/oidc-discovery-provider/provider-server-api.conf" ]
  oidc-discovery-provider-mashup:
    image: oidc-discovery-provider-mashup
    hostname: oidc-discovery-provider-mashup
    depends_on: [ "spire-server" ]
    volumes:
      - ./conf/oidc-discovery-provider:/opt/spire/conf/oidc-discovery-provider
      - ./conf/agent:/opt/spire/conf/agent
      - ./conf/server:/opt/spire/conf/server
    command: [ "-config", "/opt/spire/conf/agent/agent.conf" ]
